{
  CubeManager mgr=CubeManager.getInstance(getTestConfig());
  CubeInstance cube=mgr.getCube("test_kylin_cube_with_slr_empty");
  cube.setAutoMergeTimeRanges(new long[]{2000,6000});
  mgr.updateCube(new CubeBuilder(cube));
  assertTrue(cube.needAutoMerge());
  assertEquals(0,cube.getSegments().size());
  CubeSegment seg1=mgr.appendSegments(cube,1000);
  seg1.setStatus(SegmentStatusEnum.READY);
  CubeSegment seg2=mgr.appendSegments(cube,2000);
  seg2.setStatus(SegmentStatusEnum.READY);
  CubeBuilder cubeBuilder=new CubeBuilder(cube);
  mgr.updateCube(cubeBuilder);
  assertEquals(2,cube.getSegments().size());
  CubeSegment mergedSeg=mgr.autoMergeCubeSegments(cube);
  assertTrue(mergedSeg != null);
}
