{
  CubeInstance cube=cubeService.getCubeManager().getCube(cubeName);
  if (null == cube) {
    throw new InternalErrorException("Cannot find cube " + cubeName);
  }
  CubeSegment segment=deserializeCubeSegment(cubeSegmentRequest);
  cubeService.getCubeManager().validateNewSegments(cube,segment);
  cube.getSegments().add(segment);
  Collections.sort(cube.getSegments());
  try {
    cubeService.getCubeManager().updateCube(cube,true);
  }
 catch (  IOException e) {
    logger.error("Failed to deal with the request:" + e.getLocalizedMessage(),e);
    throw new InternalErrorException("Failed to deal with the request: " + e.getLocalizedMessage());
  }
  cubeSegmentRequest.setSuccessful(true);
  cubeSegmentRequest.setMessage("Successfully append cube segment " + segment.getName());
  return cubeSegmentRequest;
}
