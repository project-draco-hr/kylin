{
  CubeSegment segment=cubeManager.refreshSegment(cubeManager.getCube(cubeName),0,0,startOffset,endOffset);
  segment.setAdditionalInfo(partitionOffsetMap);
  CubeInstance cubeInstance=cubeManager.getCube(cubeName);
  CubeUpdate cubeBuilder=new CubeUpdate(cubeInstance);
  cubeBuilder.setToUpdateSegs(segment);
  cubeManager.updateCube(cubeBuilder);
  segment=cubeManager.getCube(cubeName).getSegmentById(segment.getUuid());
  DefaultChainedExecutable job=EngineFactory.createBatchCubingJob(segment,"TEST");
  jobService.addJob(job);
  waitForJob(job.getId());
  return job.getId();
}
