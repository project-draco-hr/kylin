{
  ts=TsConditionExtractor.extractTsCondition(partitionColRef,sqlDigest.filter);
  if (ts == null || ts.isEmpty()) {
    logger.info("ts range in the query conflicts,return empty directly");
    return ITupleIterator.EMPTY_TUPLE_ITERATOR;
  }
  ITupleIterator ret=null;
  boolean enableDynamicCache=sqlDigest.groupbyColumns.contains(partitionColRef);
  if (enableDynamicCache) {
    StreamSQLResult cachedResult=getStreamSQLResult(new StreamSQLDigest(sqlDigest,partitionColRef));
    if (cachedResult != null) {
      ret=tryReuseCache(context,sqlDigest,returnTupleInfo,ret,cachedResult);
    }
 else {
      logger.info("no cache entry for this query");
    }
  }
  if (ret == null) {
    ret=underlyingStorage.search(context,sqlDigest,returnTupleInfo);
    noCacheUsed=true;
    logger.info("No Cache being used");
  }
 else {
    noCacheUsed=false;
    logger.info("Cache being used");
  }
  if (enableDynamicCache) {
    final TeeTupleIterator tee=new TeeTupleIterator(ret);
    tee.addCloseListener(this);
    return tee;
  }
 else {
    return ret;
  }
}
