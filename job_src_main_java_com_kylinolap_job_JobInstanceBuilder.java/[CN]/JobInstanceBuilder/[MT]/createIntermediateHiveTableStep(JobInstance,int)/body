{
  IJoinedFlatTableDesc intermediateTableDesc=new CubeJoinedFlatTableDesc(cube.getDescriptor(),this.cubeSegment);
  String dropTableHql=JoinedFlatTable.generateDropTableStatement(intermediateTableDesc,jobUUID);
  String createTableHql=JoinedFlatTable.generateCreateTableStatement(intermediateTableDesc,jobWorkingDir,jobUUID);
  String insertDataHql=JoinedFlatTable.generateInsertDataStatement(intermediateTableDesc,jobUUID,this.engineConfig);
  JobStep intermediateHiveTableStep=new JobStep();
  intermediateHiveTableStep.setName(JobConstants.STEP_NAME_CREATE_FLAT_HIVE_TABLE);
  StringBuffer buf=new StringBuffer();
  buf.append("hive -e \"");
  buf.append(dropTableHql + "\n");
  buf.append(createTableHql + "\n");
  buf.append(insertDataHql + "\n");
  buf.append("\"");
  intermediateHiveTableStep.setSequenceID(stepSeqNum);
  intermediateHiveTableStep.setExecCmd(buf.toString());
  intermediateHiveTableStep.setStatus(JobStepStatusEnum.PENDING);
  intermediateHiveTableStep.setRunAsync(false);
  intermediateHiveTableStep.setCmdType(JobStepCmdTypeEnum.SHELL_CMD_HADOOP);
  return intermediateHiveTableStep;
}
