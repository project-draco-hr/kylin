{
  if (cube.getMergingSegments() == null || cube.getMergingSegments().size() < 2) {
    throw new IllegalArgumentException("Merging segments count should be more than 2");
  }
  String[] cuboidPaths=new String[cube.getMergingSegments().size()];
  for (int i=0; i < cube.getMergingSegments().size(); i++) {
    CubeSegment seg=cube.getMergingSegments().get(i);
    cuboidPaths[i]=JobInstance.getJobWorkingDir(seg.getLastBuildJobID(),engineConfig.getHdfsWorkingDirectory()) + "/" + jobInstance.getRelatedCube()+ "/cuboid/*";
  }
  String formattedPath=formatPaths(cuboidPaths);
  int stepSeqNum=0;
  List<JobStep> result=Lists.newArrayList();
  result.add(createMergeCuboidDataStep(jobInstance,stepSeqNum++,formattedPath));
  result.add(createRangeRowkeyDistributionStep(jobInstance,stepSeqNum++,jobWorkingDir + "/" + cubeName+ "/merged_cuboid"));
  result.add(createCreateHTableStep(jobInstance,stepSeqNum++));
  result.add(createConvertCuboidToHfileStep(jobInstance,stepSeqNum++,jobWorkingDir + "/" + cubeName+ "/merged_cuboid"));
  result.add(createBulkLoadStep(jobInstance,stepSeqNum++));
  try {
    log.debug(JsonUtil.writeValueAsIndentString(jobInstance));
  }
 catch (  Exception e) {
    log.error(e.getMessage());
  }
  return result;
}
