{
  try {
    while (!isAllCuboidDone()) {
      CuboidTask task=null;
      while (task == null && taskHasNoException()) {
        task=taskPending.poll(15,TimeUnit.SECONDS);
      }
      if (task == null)       break;
      CuboidResult newCuboid=buildCuboid(task.parent,task.childCuboidId);
      addChildTasks(newCuboid);
      if (isAllCuboidDone()) {
        for (        Thread t : taskThreads) {
          if (t != Thread.currentThread())           t.interrupt();
        }
      }
    }
  }
 catch (  Throwable ex) {
    if (!isAllCuboidDone()) {
      logger.error("task thread exception",ex);
      taskThreadExceptions[id]=ex;
    }
  }
}
