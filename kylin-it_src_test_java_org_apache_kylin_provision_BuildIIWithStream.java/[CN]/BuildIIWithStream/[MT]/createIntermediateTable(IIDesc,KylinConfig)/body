{
  IIJoinedFlatTableDesc intermediateTableDesc=new IIJoinedFlatTableDesc(desc);
  JobEngineConfig jobEngineConfig=new JobEngineConfig(kylinConfig);
  final String uuid=UUID.randomUUID().toString();
  final String useDatabaseHql="USE " + kylinConfig.getHiveDatabaseForIntermediateTable() + ";";
  final String dropTableHql=JoinedFlatTable.generateDropTableStatement(intermediateTableDesc);
  final String createTableHql=JoinedFlatTable.generateCreateTableStatement(intermediateTableDesc,JobBuilderSupport.getJobWorkingDir(jobEngineConfig,uuid));
  String insertDataHqls;
  try {
    insertDataHqls=JoinedFlatTable.generateInsertDataStatement(intermediateTableDesc,jobEngineConfig);
  }
 catch (  IOException e1) {
    e1.printStackTrace();
    throw new RuntimeException("Failed to generate insert data SQL for intermediate table.");
  }
  ShellExecutable step=new ShellExecutable();
  HiveCmdBuilder hiveCmdBuilder=new HiveCmdBuilder();
  hiveCmdBuilder.addStatement(useDatabaseHql);
  hiveCmdBuilder.addStatement(dropTableHql);
  hiveCmdBuilder.addStatement(createTableHql);
  hiveCmdBuilder.addStatement(insertDataHqls);
  step.setCmd(hiveCmdBuilder.build());
  logger.info(step.getCmd());
  step.setName(ExecutableConstants.STEP_NAME_CREATE_FLAT_HIVE_TABLE);
  kylinConfig.getCliCommandExecutor().execute(step.getCmd(),null);
  return intermediateTableDesc.getTableName();
}
