{
  this.cuboid=cuboid;
  this.cubeSeg=cubeSeg;
  ITupleFilterTransformer translator=new BuildInFunctionTransformer(cubeSeg.getDimensionEncodingMap());
  filter=translator.transform(filter);
  String plannerName=KylinConfig.getInstanceFromEnv().getQueryStorageVisitPlanner();
  GTScanRangePlanner scanRangePlanner;
  try {
    scanRangePlanner=(GTScanRangePlanner)Class.forName(plannerName).getConstructor(CubeSegment.class,Cuboid.class,TupleFilter.class,Set.class,Set.class,Collection.class).newInstance(cubeSeg,cuboid,filter,dimensions,groups,metrics);
  }
 catch (  Exception e) {
    throw new RuntimeException(e);
  }
  scanRequest=scanRangePlanner.planScanRequest(allowPreAggregate);
  scanner=new ScannerWorker(cubeSeg,cuboid,scanRequest);
}
