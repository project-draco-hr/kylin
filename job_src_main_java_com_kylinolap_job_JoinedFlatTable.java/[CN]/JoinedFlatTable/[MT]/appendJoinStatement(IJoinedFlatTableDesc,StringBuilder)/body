{
  Set<String> dimTableCache=new HashSet<String>();
  DataModelDesc dataModelDesc=intermediateTableDesc.getDataModel();
  String factTableName=dataModelDesc.getFactTable();
  String factTableAlias=intermediateTableDesc.getTableAlias(factTableName);
  sql.append("FROM " + factTableName + " as "+ factTableAlias+ " \n");
  for (  LookupDesc lookupDesc : dataModelDesc.getLookups()) {
    JoinDesc join=lookupDesc.getJoin();
    if (join != null && join.getType().equals("") == false) {
      String joinType=join.getType().toUpperCase();
      String dimTableName=lookupDesc.getTable();
      if (!dimTableCache.contains(dimTableName)) {
        TblColRef[] pk=join.getPrimaryKeyColumns();
        TblColRef[] fk=join.getForeignKeyColumns();
        if (pk.length != fk.length) {
          throw new RuntimeException("Invalid join condition of lookup table:" + lookupDesc);
        }
        sql.append(joinType + " JOIN " + dimTableName+ " as "+ intermediateTableDesc.getTableAlias(dimTableName)+ "\n");
        sql.append("ON ");
        for (int i=0; i < pk.length; i++) {
          if (i > 0) {
            sql.append(" AND ");
          }
          sql.append(factTableAlias + "." + fk[i].getName()+ " = "+ intermediateTableDesc.getTableAlias(dimTableName)+ "."+ pk[i].getName());
        }
        sql.append("\n");
        dimTableCache.add(dimTableName);
      }
    }
  }
}
