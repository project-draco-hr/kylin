{
  int offset=0;
  for (int i=0; i < dimensions.trueBitCount(); i++) {
    int c=dimensions.trueBitAt(i);
    final int columnLength=info.codeSystem.maxCodeLength(c);
    record.cols[c].set(key,offset,columnLength);
    offset+=columnLength;
  }
  metricsBuf.clear();
  for (int i=0; i < value.length; i++) {
    int col=metrics.trueBitAt(i);
    int pos=metricsBuf.position();
    info.codeSystem.encodeColumnValue(col,value[i].getState(),metricsBuf);
    record.cols[col].set(metricsBuf.array(),pos,metricsBuf.position() - pos);
  }
}
