{
  Executors.newSingleThreadExecutor(new DaemonThreadFactory()).execute(new Runnable(){
    @Override public void run(){
      final String[] nodes=KylinConfig.getInstanceFromEnv().getRestServers();
      if (nodes == null || nodes.length < 1) {
        logger.warn("There is no available rest server; check the 'kylin.rest.servers' config");
        return;
      }
      logger.debug(nodes.length + " nodes in the cluster: " + Arrays.toString(nodes));
      final List<RestClient> restClients=Lists.newArrayList();
      for (      String node : nodes) {
        restClients.add(new RestClient(node));
      }
      final ExecutorService wipingCachePool=Executors.newFixedThreadPool(restClients.size());
      while (true) {
        try {
          final BroadcastEvent broadcastEvent=broadcastEvents.takeFirst();
          logger.info("new broadcast event:" + broadcastEvent);
          for (          final RestClient restClient : restClients) {
            wipingCachePool.execute(new Runnable(){
              @Override public void run(){
                try {
                  restClient.wipeCache(broadcastEvent.getType(),broadcastEvent.getAction(),broadcastEvent.getName());
                }
 catch (                IOException e) {
                  logger.warn("Thread failed during wipe cache at " + broadcastEvent);
                }
              }
            }
);
          }
        }
 catch (        Exception e) {
          logger.error("error running wiping",e);
        }
      }
    }
  }
);
}
