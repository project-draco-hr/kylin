{
  File propFile=getKylinProperties();
  if (propFile == null || !propFile.exists()) {
    logger.error("fail to locate kylin.properties");
    throw new RuntimeException("fail to locate kylin.properties");
  }
  File overrideFile=new File(propFile.getParentFile(),propFile.getName() + ".override");
  if (overrideFile.exists()) {
    FileInputStream fis=null;
    FileInputStream fis2=null;
    try {
      fis=new FileInputStream(propFile);
      fis2=new FileInputStream(overrideFile);
      Properties conf=new Properties();
      conf.load(fis);
      Properties override=new Properties();
      override.load(fis2);
      for (      Map.Entry<Object,Object> entries : override.entrySet()) {
        conf.setProperty(entries.getKey().toString(),entries.getValue().toString());
      }
      ByteArrayOutputStream bout=new ByteArrayOutputStream();
      conf.store(bout,"output");
      return new ByteArrayInputStream(bout.toByteArray());
    }
 catch (    IOException e) {
      throw new RuntimeException(e);
    }
 finally {
      IOUtils.closeQuietly(fis);
      IOUtils.closeQuietly(fis2);
    }
  }
 else {
    try {
      return new FileInputStream(propFile);
    }
 catch (    FileNotFoundException e) {
      logger.error("this should not happen");
      throw new RuntimeException(e);
    }
  }
}
