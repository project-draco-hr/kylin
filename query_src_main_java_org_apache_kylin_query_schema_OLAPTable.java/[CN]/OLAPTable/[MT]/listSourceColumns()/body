{
  ProjectManager mgr=ProjectManager.getInstance(olapSchema.getConfig());
  List<ColumnDesc> tableColumns=Lists.newArrayList(mgr.listExposedColumns(olapSchema.getProjectName(),sourceTable.getIdentity()));
  List<MeasureDesc> countMeasures=mgr.listEffectiveMeasures(olapSchema.getProjectName(),sourceTable.getIdentity(),true);
  HashSet<String> metFields=new HashSet<String>();
  List<ColumnDesc> metricColumns=Lists.newArrayList();
  for (  MeasureDesc m : countMeasures) {
    FunctionDesc func=m.getFunction();
    String fieldName=func.getRewriteFieldName();
    if (!metFields.contains(fieldName)) {
      metFields.add(fieldName);
      ColumnDesc fakeCountCol=new ColumnDesc();
      fakeCountCol.setName(fieldName);
      fakeCountCol.setDatatype(func.getSQLType().toString());
      if (func.isCount())       fakeCountCol.setNullable(false);
      fakeCountCol.init(sourceTable);
      metricColumns.add(fakeCountCol);
    }
  }
  HashSet<ColumnDesc> updateColumns=Sets.newHashSet();
  for (  MeasureDesc m : mgr.listEffectiveMeasures(olapSchema.getProjectName(),sourceTable.getIdentity(),false)) {
    if (m.getFunction().isSum()) {
      FunctionDesc functionDesc=m.getFunction();
      if (functionDesc.getReturnDataType() != functionDesc.getSQLType() && functionDesc.getReturnDataType().isBigInt() && functionDesc.getSQLType().isIntegerFamily()) {
        updateColumns.add(functionDesc.getParameter().getColRefs().get(0).getColumnDesc());
      }
    }
  }
  for (  ColumnDesc upgrade : updateColumns) {
    int index=tableColumns.indexOf(upgrade);
    tableColumns.get(index).setDatatype("bigint");
  }
  return Lists.newArrayList(Iterables.concat(tableColumns,metricColumns));
}
