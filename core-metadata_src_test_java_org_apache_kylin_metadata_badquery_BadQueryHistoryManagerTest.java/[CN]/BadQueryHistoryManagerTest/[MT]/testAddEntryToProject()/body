{
  KylinConfig kylinConfig=getTestConfig();
  BadQueryHistoryManager manager=BadQueryHistoryManager.getInstance(kylinConfig);
  BadQueryHistory history=manager.addEntryToProject("sql","adj",123,"server","t-0","default");
  NavigableSet<BadQueryEntry> entries=history.getEntries();
  assertEquals(3,entries.size());
  BadQueryEntry newEntry=entries.last();
  assertEquals("sql",newEntry.getSql());
  assertEquals("adj",newEntry.getAdj());
  assertEquals(123,newEntry.getStartTime());
  assertEquals("server",newEntry.getServer());
  assertEquals("t-0",newEntry.getThread());
  for (int i=0; i < kylinConfig.getBadQueryHistoryNum(); i++) {
    history=manager.addEntryToProject("sql","adj",123 + i + 1,"server","t-0","default");
  }
  assertEquals(kylinConfig.getBadQueryHistoryNum(),history.getEntries().size());
}
