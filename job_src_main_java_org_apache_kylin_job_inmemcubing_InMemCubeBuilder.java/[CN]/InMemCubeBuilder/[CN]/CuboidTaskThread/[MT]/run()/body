{
  try {
    while (taskCuboidCompleted.get() < outputCuboidExpected) {
      CuboidTask task=null;
synchronized (taskPending) {
        while (task == null && taskHasNoException()) {
          task=taskPending.pollFirst();
          if (task == null)           taskPending.wait(60000);
        }
      }
      if (task == null)       break;
      CuboidResult newCuboid=buildCuboid(task.parent,task.childCuboidId);
      addChildTasks(newCuboid);
      task.parent.markOneSpanningDone();
      taskCuboidCompleted.incrementAndGet();
      if (taskCuboidCompleted.get() == outputCuboidExpected) {
        for (        Thread t : taskThreads) {
          if (t != Thread.currentThread())           t.interrupt();
        }
      }
    }
  }
 catch (  Throwable ex) {
    if (taskCuboidCompleted.get() < outputCuboidExpected) {
      logger.error("task thread exception",ex);
      taskThreadExceptions[id]=ex;
    }
  }
}
