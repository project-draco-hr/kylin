{
  createTestMetadata();
  logger.info("The metadataUrl is : " + this.getTestConfig());
  MetadataManager.removeInstance(this.getTestConfig());
  CubeManager.removeInstance(this.getTestConfig());
  ProjectManager.removeInstance(this.getTestConfig());
  DictionaryManager.removeInstance(this.getTestConfig());
  FileUtils.deleteDirectory(new File("../job/meta"));
  MergeCuboidMapper mapper=new MergeCuboidMapper();
  mapDriver=MapDriver.newMapDriver(mapper);
  cubeManager=CubeManager.getInstance(this.getTestConfig());
  cube=cubeManager.getCube("test_kylin_cube_without_slr_left_join_ready_2_segments");
  dictionaryManager=DictionaryManager.getInstance(getTestConfig());
  lfn=cube.getDescriptor().findColumnRef("DEFAULT.TEST_KYLIN_FACT","LSTG_FORMAT_NAME");
  lsi=cube.getDescriptor().findColumnRef("DEFAULT.TEST_KYLIN_FACT","CAL_DT");
  ssc=cube.getDescriptor().findColumnRef("DEFAULT.TEST_CATEGORY_GROUPINGS","META_CATEG_NAME");
  DictionaryInfo sharedDict=makeSharedDict();
  boolean isFirstSegment=true;
  for (  CubeSegment segment : cube.getSegments()) {
    TableSignature signature=new TableSignature();
    signature.setSize(100);
    signature.setLastModifiedTime(System.currentTimeMillis());
    signature.setPath("fake_dict_for" + lfn.getName() + segment.getName());
    DictionaryInfo newDictInfo=new DictionaryInfo(lfn.getTable(),lfn.getColumn().getName(),lfn.getColumn().getZeroBasedIndex(),"string",signature,"");
    List<byte[]> values=new ArrayList<byte[]>();
    values.add(new byte[]{97,97,97});
    if (isFirstSegment)     values.add(new byte[]{99,99,99});
 else     values.add(new byte[]{98,98,98});
    Dictionary<?> dict=DictionaryGenerator.buildDictionaryFromValueList(newDictInfo,values);
    dictionaryManager.trySaveNewDict(dict,newDictInfo);
    ((TrieDictionary)dict).dump(System.out);
    segment.putDictResPath(lfn,newDictInfo.getResourcePath());
    segment.putDictResPath(lsi,sharedDict.getResourcePath());
    segment.putDictResPath(ssc,sharedDict.getResourcePath());
    cubeManager.updateCube(cube);
    isFirstSegment=false;
  }
}
