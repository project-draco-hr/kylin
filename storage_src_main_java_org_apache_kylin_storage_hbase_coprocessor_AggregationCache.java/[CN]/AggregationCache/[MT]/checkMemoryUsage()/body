{
  if (firstKey == null)   return;
  if (rowMemBytes <= 0) {
    if (aggBufMap.size() > 0) {
      rowMemBytes=0;
      MeasureAggregator[] measureAggregators=aggBufMap.get(firstKey);
      for (      MeasureAggregator agg : measureAggregators) {
        rowMemBytes+=agg.getMemBytesEstimate();
      }
    }
  }
  int size=aggBufMap.size();
  int memUsage=(40 + rowMemBytes) * size;
  if (memUsage > MEMORY_USAGE_CAP) {
    throw new RuntimeException("Kylin coprocess memory usage goes beyond cap, (40 + " + rowMemBytes + ") * "+ size+ " > "+ MEMORY_USAGE_CAP+ ". Abort coprocessor.");
  }
}
