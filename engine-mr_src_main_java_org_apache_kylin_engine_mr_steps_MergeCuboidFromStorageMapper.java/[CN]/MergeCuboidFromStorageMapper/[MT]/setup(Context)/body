{
  super.bindCurrentConfiguration(context.getConfiguration());
  config=AbstractHadoopJob.loadKylinPropsAndMetadata();
  cubeName=context.getConfiguration().get(BatchConstants.CFG_CUBE_NAME).toUpperCase();
  segmentName=context.getConfiguration().get(BatchConstants.CFG_CUBE_SEGMENT_NAME).toUpperCase();
  cubeManager=CubeManager.getInstance(config);
  cube=cubeManager.getCube(cubeName);
  cubeDesc=cube.getDescriptor();
  mergedCubeSegment=cube.getSegment(segmentName,SegmentStatusEnum.NEW);
  storageInputFormat=MRUtil.getBatchMergeInputSide2(mergedCubeSegment).getStorageInputFormat();
  newKeyBodyBuf=new byte[RowConstants.ROWKEY_BUFFER_SIZE];
  newKeyBuf=ByteArray.allocate(RowConstants.ROWKEY_BUFFER_SIZE);
  sourceCubeSegment=storageInputFormat.findSourceSegment(context);
  logger.info("Source cube segment: " + sourceCubeSegment);
  rowKeySplitter=new RowKeySplitter(sourceCubeSegment,65,255);
  rowKeyEncoderProvider=new RowKeyEncoderProvider(mergedCubeSegment);
  measureDescs=cubeDesc.getMeasures();
  codec=new MeasureCodec(measureDescs);
  dictMeasures=Lists.newArrayList();
  for (int i=0; i < measureDescs.size(); i++) {
    MeasureDesc measureDesc=measureDescs.get(i);
    MeasureType measureType=measureDesc.getFunction().getMeasureType();
    if (measureType.getColumnsNeedDictionary(measureDesc.getFunction()).isEmpty() == false) {
      dictMeasures.add(new Pair<Integer,MeasureIngester>(i,measureType.newIngester()));
    }
  }
  if (dictMeasures.size() > 0) {
    oldDicts=sourceCubeSegment.buildDictionaryMap();
    newDicts=mergedCubeSegment.buildDictionaryMap();
  }
}
