{
  Map<TblColRef,Dictionary<String>> result=Maps.newHashMap();
  CubeDesc desc=cube.getDescriptor();
  CubeJoinedFlatTableDesc flatTableDesc=new CubeJoinedFlatTableDesc(desc,null);
  int nColumns=flatTableDesc.getColumnList().size();
  List<TblColRef> columns=Cuboid.getBaseCuboid(desc).getColumns();
  for (int c=0; c < columns.size(); c++) {
    TblColRef col=columns.get(c);
    if (desc.getRowkey().isUseDictionary(col)) {
      logger.info("Building dictionary for " + col);
      List<byte[]> valueList=readValueList(flatTable,nColumns,flatTableDesc.getRowKeyColumnIndexes()[c]);
      Dictionary<String> dict=DictionaryGenerator.buildDictionaryFromValueEnumerator(col.getType(),new IterableDictionaryValueEnumerator(valueList));
      result.put(col,dict);
    }
  }
  for (int measureIdx=0; measureIdx < cube.getDescriptor().getMeasures().size(); measureIdx++) {
    MeasureDesc measureDesc=cube.getDescriptor().getMeasures().get(measureIdx);
    FunctionDesc func=measureDesc.getFunction();
    if (func.isTopN()) {
      int[] flatTableIdx=flatTableDesc.getMeasureColumnIndexes()[measureIdx];
      int literalColIdx=flatTableIdx[flatTableIdx.length - 1];
      TblColRef literalCol=func.getTopNLiteralColumn();
      logger.info("Building dictionary for " + literalCol);
      List<byte[]> valueList=readValueList(flatTable,nColumns,literalColIdx);
      Dictionary<String> dict=DictionaryGenerator.buildDictionaryFromValueEnumerator(literalCol.getType(),new IterableDictionaryValueEnumerator(valueList));
      result.put(literalCol,dict);
    }
  }
  return result;
}
