{
  final String topic=kafkaClusterConfig.getTopic();
  int retry=3;
  while (retry > 0) {
    final Broker leadBroker=Preconditions.checkNotNull(getLeadBroker(kafkaClusterConfig,partitionId),"unable to find leadBroker with config:" + kafkaClusterConfig + " partitionId:"+ partitionId);
    final FetchResponse response=KafkaRequester.fetchResponse(topic,partitionId,offset,leadBroker,kafkaClusterConfig);
    Preconditions.checkArgument(response.errorCode(topic,partitionId) == 0,"errorCode of FetchResponse is:" + response.errorCode(topic,partitionId));
    final Iterator<MessageAndOffset> iterator=response.messageSet(topic,partitionId).iterator();
    if (iterator.hasNext()) {
      return iterator.next();
    }
 else {
      retry--;
      try {
        Thread.sleep(1000);
      }
 catch (      InterruptedException e) {
        throw new RuntimeException(e);
      }
      continue;
    }
  }
  throw new IllegalStateException(String.format("try to get timestamp of topic: %s, partitionId: %d, offset: %d, failed to get StreamMessage from kafka",topic,partitionId,offset));
}
