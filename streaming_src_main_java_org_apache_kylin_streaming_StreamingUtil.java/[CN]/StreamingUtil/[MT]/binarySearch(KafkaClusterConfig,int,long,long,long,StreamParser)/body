{
  Map<Long,Long> cache=Maps.newHashMap();
  while (startOffset < endOffset) {
    long midOffset=startOffset + ((endOffset - startOffset) >> 1);
    long startTimestamp=getDataTimestamp(kafkaClusterConfig,partitionId,startOffset,streamParser,cache);
    long endTimestamp=getDataTimestamp(kafkaClusterConfig,partitionId,endOffset,streamParser,cache);
    long midTimestamp=getDataTimestamp(kafkaClusterConfig,partitionId,midOffset,streamParser,cache);
    if (startTimestamp >= targetTimestamp) {
      return startOffset;
    }
    if (endTimestamp <= targetTimestamp) {
      return endOffset;
    }
    if (targetTimestamp == midTimestamp) {
      return midOffset;
    }
 else     if (targetTimestamp < midTimestamp) {
      endOffset=midOffset - 1;
      continue;
    }
 else {
      startOffset=midOffset + 1;
      continue;
    }
  }
  return startOffset;
}
