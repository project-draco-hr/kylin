{
  while (startOffset <= endOffset + 2) {
    long midOffset=startOffset + ((endOffset - startOffset) >> 1);
    long startTimestamp=getDataTimestamp(kafkaClusterConfig,partitionId,startOffset,streamParser);
    long endTimestamp=getDataTimestamp(kafkaClusterConfig,partitionId,endOffset,streamParser);
    long midTimestamp=getDataTimestamp(kafkaClusterConfig,partitionId,midOffset,streamParser);
    if (startTimestamp > targetTimestamp) {
      return startOffset;
    }
    if (endTimestamp < targetTimestamp) {
      return endOffset;
    }
    if (targetTimestamp == midTimestamp) {
      return midOffset;
    }
 else     if (targetTimestamp < midTimestamp) {
      endOffset=midOffset;
      continue;
    }
 else {
      startOffset=midOffset;
      continue;
    }
  }
  return startOffset;
}
