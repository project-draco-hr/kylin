{
  String clientName="client_" + topic + "_"+ partitionId;
  SimpleConsumer consumer=getSimpleConsumer(broker,kafkaConfig.getTimeout(),kafkaConfig.getBufferSize(),clientName);
  TopicAndPartition topicAndPartition=new TopicAndPartition(topic,partitionId);
  Map<TopicAndPartition,PartitionOffsetRequestInfo> requestInfo=new HashMap<TopicAndPartition,PartitionOffsetRequestInfo>();
  requestInfo.put(topicAndPartition,new PartitionOffsetRequestInfo(whichTime,1));
  kafka.javaapi.OffsetRequest request=new kafka.javaapi.OffsetRequest(requestInfo,kafka.api.OffsetRequest.CurrentVersion(),clientName);
  OffsetResponse response=consumer.getOffsetsBefore(request);
  if (response.hasError()) {
    logger.error("Error fetching data Offset Data the Broker. Reason: " + response.errorCode(topic,partitionId));
    return 0;
  }
  long[] offsets=response.offsets(topic,partitionId);
  return offsets[0];
}
