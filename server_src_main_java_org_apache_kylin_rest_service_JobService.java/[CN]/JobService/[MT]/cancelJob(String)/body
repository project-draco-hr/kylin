{
  final JobInstance jobInstance=getJobInstance(jobId);
  final String segmentId=jobInstance.getRelatedSegment();
  CubeInstance cubeInstance=getCubeManager().getCube(jobInstance.getRelatedCube());
  final CubeSegment segment=cubeInstance.getSegmentById(segmentId);
  if (segment != null && segment.getStatus() == SegmentStatusEnum.NEW) {
    CubeBuilder cubeBuilder=new CubeBuilder(cubeInstance);
    cubeBuilder.setToRemoveSegs(cubeInstance.getSegments().toArray(new CubeSegment[cubeInstance.getSegments().size()]));
    getCubeManager().updateCube(cubeBuilder);
  }
  getExecutableManager().discardJob(jobId);
  return jobInstance;
}
