{
  if (filter == null)   return filter;
  if (filter instanceof CompareTupleFilter) {
    return translateDerivedInCompare((CompareTupleFilter)filter,collector);
  }
  List<TupleFilter> children=(List<TupleFilter>)filter.getChildren();
  for (int i=0; i < children.size(); i++) {
    TupleFilter translated=translateDerived(children.get(i),collector);
    if (children.get(i) != translated) {
      if ((filter instanceof LogicalTupleFilter) == false)       throw new IllegalStateException("Cannot replace derived filter");
      children.set(i,translated);
    }
  }
  return filter;
}
