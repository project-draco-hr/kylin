{
  List<CubeSegment> readySegments=cubeInstance.getSegments(SegmentStatusEnum.READY);
  CubePartitionDesc cubePartitionDesc=cubeInstance.getDescriptor().getCubePartitionDesc();
  final long initStartDate=cubePartitionDesc.getPartitionDateColumn() != null ? cubePartitionDesc.getPartitionDateStart() : 0;
  long startDate=initStartDate;
  for (  CubeSegment readySegment : readySegments) {
    if (startDate == readySegment.getDateRangeStart() && startDate < readySegment.getDateRangeEnd()) {
      startDate=readySegment.getDateRangeEnd();
    }
 else {
      throw new CubeIntegrityException("there is gap in cube segments");
    }
  }
  if (newSegments.size() != 1) {
    throw new CubeIntegrityException("there are more than 2 segments");
  }
  final CubeSegment newSegment=newSegments.get(0);
  if (cubeInstance.appendOnHll()) {
    if (newSegment.getDateRangeStart() == initStartDate && startDate < newSegment.getDateRangeEnd()) {
      return;
    }
  }
 else {
    if (newSegment.getDateRangeStart() == startDate) {
      return;
    }
  }
  throw new CubeIntegrityException("invalid segment date range from " + newSegment.getDateRangeStart() + " to "+ newSegment.getDateRangeEnd());
}
