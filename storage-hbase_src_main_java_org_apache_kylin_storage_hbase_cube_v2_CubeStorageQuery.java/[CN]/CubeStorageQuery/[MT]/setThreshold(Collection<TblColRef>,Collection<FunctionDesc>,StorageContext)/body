{
  boolean hasMemHungryCountDistinct=false;
  for (  FunctionDesc func : metrics) {
    if (func.isCountDistinct() && !func.isHolisticCountDistinct()) {
      hasMemHungryCountDistinct=true;
    }
  }
  if (hasMemHungryCountDistinct == false) {
    return;
  }
  int rowSizeEst=dimensions.size() * 3;
  for (  FunctionDesc func : metrics) {
    rowSizeEst+=func.getReturnDataType().getStorageBytesEstimate();
  }
  long rowEst=this.cubeInstance.getConfig().getQueryMemBudget() / rowSizeEst;
  if (rowEst > 0) {
    logger.info("Memory budget is set to: " + rowEst);
    context.setThreshold((int)rowEst);
  }
 else {
    logger.info("Memory budget is not set.");
  }
}
