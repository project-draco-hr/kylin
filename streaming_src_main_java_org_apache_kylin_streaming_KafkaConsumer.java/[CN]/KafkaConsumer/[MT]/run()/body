{
  try {
    Broker leadBroker=getLeadBroker();
    while (true) {
      if (leadBroker == null) {
        leadBroker=getLeadBroker();
      }
      if (leadBroker == null) {
        logger.warn("cannot find lead broker");
        continue;
      }
      final FetchResponse fetchResponse=KafkaRequester.fetchResponse(topic,partitionId,offset,leadBroker,kafkaConfig);
      if (fetchResponse.errorCode(topic,partitionId) != 0) {
        logger.warn("fetch response offset:" + offset + " errorCode:"+ fetchResponse.errorCode(topic,partitionId));
        continue;
      }
      for (      MessageAndOffset messageAndOffset : fetchResponse.messageSet(topic,partitionId)) {
        try {
          consume(messageAndOffset.offset(),messageAndOffset.message().payload());
        }
 catch (        Exception e) {
          logger.error("error put streamQueue",e);
          break;
        }
        offset++;
      }
    }
  }
 catch (  Exception e) {
    logger.error("consumer has encountered an error",e);
  }
}
