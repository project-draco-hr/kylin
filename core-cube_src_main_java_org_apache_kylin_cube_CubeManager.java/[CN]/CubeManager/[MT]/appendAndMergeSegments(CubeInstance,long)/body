{
  checkNoBuildingSegment(cube);
  checkCubeIsPartitioned(cube);
  if (cube.getSegments().size() == 0)   throw new IllegalStateException("expect at least one existing segment");
  long appendStart=calculateStartDateForAppendSegment(cube);
  CubeSegment appendSegment=newSegment(cube,appendStart,endDate);
  long startDate=cube.getDescriptor().getPartitionDateStart();
  CubeSegment mergeSegment=newSegment(cube,startDate,endDate);
  validateNewSegments(cube,mergeSegment);
  CubeUpdate cubeBuilder=new CubeUpdate(cube).setToAddSegs(appendSegment,mergeSegment);
  updateCube(cubeBuilder);
  return Pair.newPair(appendSegment,mergeSegment);
}
