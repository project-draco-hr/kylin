{
  CubeDesc cubeDesc=cube.getDescriptor();
  Collection<FunctionDesc> cubeFuncs=cubeDesc.listAllFunctions();
  Iterator<FunctionDesc> it=aggregations.iterator();
  while (it.hasNext()) {
    FunctionDesc functionDesc=it.next();
    if (!cubeFuncs.contains(functionDesc)) {
      TblColRef col=findTblColByMetrics(metricColumns,functionDesc,cubeDesc.getFactTable());
      functionDesc.setAppliedOnDimension(true);
      rewriteFields.remove(functionDesc.getRewriteFieldName());
      if (col != null) {
        metricColumns.remove(col);
        dimensionColumns.add(col);
        olapContext.storageContext.addOtherMandatoryColumns(col);
      }
      logger.info("Adjust OLAPContext for " + functionDesc);
    }
  }
}
