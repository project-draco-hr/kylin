{
  List<String> loadedTables=Lists.newArrayList();
  MetadataManager metaMgr=MetadataManager.getInstance(KylinConfig.getInstanceFromEnv());
  for (  String tableName : tables) {
    Table table=null;
    List<FieldSchema> partitionFields=null;
    List<FieldSchema> fields=null;
    try {
      table=hiveClient.getHiveTable(database,tableName);
      partitionFields=table.getPartitionKeys();
      fields=hiveClient.getHiveTableFields(database,tableName);
    }
 catch (    Exception e) {
      e.printStackTrace();
      throw new IOException(e);
    }
    if (fields != null && partitionFields != null && partitionFields.size() > 0) {
      fields.addAll(partitionFields);
    }
    long tableSize=hiveClient.getFileSizeForTable(table);
    long tableFileNum=hiveClient.getFileNumberForTable(table);
    TableDesc tableDesc=metaMgr.getTableDesc(database + "." + tableName);
    if (tableDesc == null) {
      tableDesc=new TableDesc();
      tableDesc.setDatabase(database.toUpperCase());
      tableDesc.setName(tableName.toUpperCase());
      tableDesc.setUuid(UUID.randomUUID().toString());
      tableDesc.setLastModified(0);
    }
    if (table.getTableType() != null) {
      tableDesc.setTableType(table.getTableType());
    }
    int columnNumber=fields.size();
    List<ColumnDesc> columns=new ArrayList<ColumnDesc>(columnNumber);
    for (int i=0; i < columnNumber; i++) {
      FieldSchema field=fields.get(i);
      ColumnDesc cdesc=new ColumnDesc();
      cdesc.setName(field.getName().toUpperCase());
      if ("float".equalsIgnoreCase(field.getType())) {
        cdesc.setDatatype("double");
      }
 else {
        cdesc.setDatatype(field.getType());
      }
      cdesc.setId(String.valueOf(i + 1));
      columns.add(cdesc);
    }
    tableDesc.setColumns(columns.toArray(new ColumnDesc[columnNumber]));
    StringBuffer partitionColumnString=new StringBuffer();
    for (int i=0, n=partitionFields.size(); i < n; i++) {
      if (i > 0)       partitionColumnString.append(", ");
      partitionColumnString.append(partitionFields.get(i).getName().toUpperCase());
    }
    Map<String,String> map=metaMgr.getTableDescExd(tableDesc.getIdentity());
    if (map == null) {
      map=Maps.newHashMap();
    }
    map.put(MetadataConstants.TABLE_EXD_TABLENAME,table.getTableName());
    map.put(MetadataConstants.TABLE_EXD_LOCATION,table.getSd().getLocation());
    map.put(MetadataConstants.TABLE_EXD_IF,table.getSd().getInputFormat());
    map.put(MetadataConstants.TABLE_EXD_OF,table.getSd().getOutputFormat());
    map.put(MetadataConstants.TABLE_EXD_OWNER,table.getOwner());
    map.put(MetadataConstants.TABLE_EXD_LAT,String.valueOf(table.getLastAccessTime()));
    map.put(MetadataConstants.TABLE_EXD_PC,partitionColumnString.toString());
    map.put(MetadataConstants.TABLE_EXD_TFS,String.valueOf(tableSize));
    map.put(MetadataConstants.TABLE_EXD_TNF,String.valueOf(tableFileNum));
    map.put(MetadataConstants.TABLE_EXD_PARTITIONED,Boolean.valueOf(partitionFields != null && partitionFields.size() > 0).toString());
    metaMgr.saveSourceTable(tableDesc);
    metaMgr.saveTableExd(tableDesc.getIdentity(),map);
    loadedTables.add(tableDesc.getIdentity());
  }
  return loadedTables;
}
