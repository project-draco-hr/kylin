{
  Queue<IIRow> buffer=Lists.newLinkedList();
  FIFOIterable bufferIterable=new FIFOIterable(buffer);
  TableRecordInfo info=new TableRecordInfo(iiDesc);
  TableRecordInfoDigest digest=info.getDigest();
  KeyValueCodec codec=new IIKeyValueCodecWithState(digest);
  Iterator<Slice> slices=codec.decodeKeyValue(bufferIterable).iterator();
  Assert.assertTrue(!slices.hasNext());
  Assert.assertEquals(iiRows.size(),digest.getColumnCount());
  for (int i=0; i < digest.getColumnCount(); ++i) {
    buffer.add(iiRows.get(i));
    if (i != digest.getColumnCount() - 1) {
      Assert.assertTrue(!slices.hasNext());
    }
 else {
      Assert.assertTrue(slices.hasNext());
    }
  }
  Slice newSlice=slices.next();
  Assert.assertEquals(newSlice.getLocalDictionaries()[0].getSize(),2);
}
