{
  SnapshotTable snapshot=new SnapshotTable(table);
  snapshot.updateRandomUuid();
  if (reuseExisting) {
    String dup=checkDup(snapshot);
    if (dup != null) {
      logger.info("Identical input " + table.getSignature() + ", reuse existing snapshot at "+ dup);
      return getSnapshotTable(dup);
    }
  }
  snapshot.takeSnapshot(table,tableDesc);
  save(snapshot);
  snapshotCache.put(snapshot.getResourcePath(),snapshot);
  return snapshot;
}
