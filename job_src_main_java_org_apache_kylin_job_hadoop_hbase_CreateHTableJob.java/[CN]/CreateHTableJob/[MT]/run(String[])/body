{
  Options options=new Options();
  options.addOption(OPTION_CUBE_NAME);
  options.addOption(OPTION_SEGMENT_NAME);
  options.addOption(OPTION_PARTITION_FILE_PATH);
  options.addOption(OPTION_HTABLE_NAME);
  options.addOption(OPTION_STATISTICS_ENABLED);
  parseOptions(options,args);
  Path partitionFilePath=new Path(getOptionValue(OPTION_PARTITION_FILE_PATH));
  boolean statistics_enabled=Boolean.parseBoolean(getOptionValue(OPTION_STATISTICS_ENABLED));
  String cubeName=getOptionValue(OPTION_CUBE_NAME).toUpperCase();
  kylinConfig=KylinConfig.getInstanceFromEnv();
  CubeManager cubeMgr=CubeManager.getInstance(kylinConfig);
  cube=cubeMgr.getCube(cubeName);
  cubeDesc=cube.getDescriptor();
  segmentName=getOptionValue(OPTION_SEGMENT_NAME);
  String tableName=getOptionValue(OPTION_HTABLE_NAME).toUpperCase();
  HTableDescriptor tableDesc=new HTableDescriptor(TableName.valueOf(tableName));
  tableDesc.setValue(HTableDescriptor.SPLIT_POLICY,ConstantSizeRegionSplitPolicy.class.getName());
  tableDesc.setValue(IRealizationConstants.HTableTag,kylinConfig.getMetadataUrlPrefix());
  Configuration conf=HBaseConfiguration.create(getConf());
  HBaseAdmin admin=new HBaseAdmin(conf);
  try {
    if (User.isHBaseSecurityEnabled(conf)) {
      tableDesc.addCoprocessor("org.apache.hadoop.hbase.security.access.SecureBulkLoadEndpoint");
    }
    for (    HBaseColumnFamilyDesc cfDesc : cubeDesc.getHBaseMapping().getColumnFamily()) {
      HColumnDescriptor cf=new HColumnDescriptor(cfDesc.getName());
      cf.setMaxVersions(1);
      if (LZOSupportnessChecker.getSupportness()) {
        logger.info("hbase will use lzo to compress cube data");
        cf.setCompressionType(Algorithm.LZO);
      }
 else {
        logger.info("hbase will not use lzo to compress cube data");
      }
      cf.setDataBlockEncoding(DataBlockEncoding.FAST_DIFF);
      cf.setInMemory(false);
      cf.setBlocksize(4 * 1024 * 1024);
      tableDesc.addFamily(cf);
    }
    byte[][] splitKeys;
    if (statistics_enabled) {
      splitKeys=getSplitsFromCuboidStatistics(conf);
    }
 else {
      splitKeys=getSplits(conf,partitionFilePath);
    }
    if (admin.tableExists(tableName)) {
      throw new RuntimeException("HBase table " + tableName + " exists!");
    }
    DeployCoprocessorCLI.deployCoprocessor(tableDesc);
    admin.createTable(tableDesc,splitKeys);
    logger.info("create hbase table " + tableName + " done.");
    return 0;
  }
 catch (  Exception e) {
    printUsage(options);
    e.printStackTrace(System.err);
    logger.error(e.getLocalizedMessage(),e);
    return 2;
  }
 finally {
    admin.close();
  }
}
