{
  SimpleConsumer consumer;
  for (  Broker broker : topicConfig.getBrokers()) {
    consumer=new SimpleConsumer(broker.host(),broker.port(),consumerConfig.getTimeout(),consumerConfig.getBufferSize(),"topic_meta_lookup");
    List<String> topics=Collections.singletonList(topicConfig.getTopic());
    TopicMetadataRequest req=new TopicMetadataRequest(topics);
    TopicMetadataResponse resp=consumer.send(req);
    final List<TopicMetadata> topicMetadatas=resp.topicsMetadata();
    if (topicMetadatas.size() != 1) {
      break;
    }
    final TopicMetadata topicMetadata=topicMetadatas.get(0);
    if (topicMetadata.errorCode() != 0) {
      break;
    }
    List<Integer> partitionIds=Lists.transform(topicMetadata.partitionsMetadata(),new Function<PartitionMetadata,Integer>(){
      @Nullable @Override public Integer apply(      PartitionMetadata partitionMetadata){
        return partitionMetadata.partitionId();
      }
    }
);
    return new TopicMeta(topicConfig.getTopic(),partitionIds);
  }
  logger.debug("cannot find topic:" + topicConfig.getTopic());
  return null;
}
