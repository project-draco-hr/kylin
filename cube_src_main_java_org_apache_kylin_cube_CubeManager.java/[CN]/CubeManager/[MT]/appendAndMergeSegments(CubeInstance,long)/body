{
  checkNoBuildingSegment(cube);
  checkCubeIsPartitioned(cube);
  if (cube.getSegments().size() == 0)   throw new IllegalStateException("expect at least one existing segment");
  long appendStart=calculateStartDateForAppendSegment(cube);
  CubeSegment appendSegment=newSegment(cube,appendStart,endDate);
  long startDate=cube.getDescriptor().getModel().getPartitionDesc().getPartitionDateStart();
  CubeSegment mergeSegment=newSegment(cube,startDate,endDate);
  validateNewSegments(cube,mergeSegment);
  CubeBuilder cubeBuilder=new CubeBuilder(cube).setToAddSegs(appendSegment,mergeSegment);
  updateCube(cubeBuilder);
  return new Pair<CubeSegment,CubeSegment>(appendSegment,mergeSegment);
}
