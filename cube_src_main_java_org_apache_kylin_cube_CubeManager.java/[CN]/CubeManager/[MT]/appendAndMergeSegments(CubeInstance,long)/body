{
  checkNoBuildingSegment(cube);
  checkCubeIsPartitioned(cube);
  if (cube.getSegments().size() == 0)   throw new IllegalStateException("expect at least one existing segment");
  long appendStart=calculateStartDateForAppendSegment(cube);
  CubeSegment appendSegment=newSegment(cube,appendStart,endDate);
  long startDate=cube.getDescriptor().getModel().getPartitionDesc().getPartitionDateStart();
  CubeSegment mergeSegment=newSegment(cube,startDate,endDate);
  validateNewSegments(cube,mergeSegment);
  cube.getSegments().add(appendSegment);
  cube.getSegments().add(mergeSegment);
  Collections.sort(cube.getSegments());
  updateCube(cube,false);
  return new Pair<CubeSegment,CubeSegment>(appendSegment,mergeSegment);
}
