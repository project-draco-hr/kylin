{
  StringBuilder hiveInitBuf=new StringBuilder();
  hiveInitBuf.append("USE ").append(conf.getConfig().getHiveDatabaseForIntermediateTable()).append(";\n");
  try {
    hiveInitBuf.append(JoinedFlatTable.generateHiveSetStatements(conf));
  }
 catch (  IOException e) {
    throw new RuntimeException("Failed to generate hive set statements for RedistributeFlatHiveTableStep",e);
  }
  String rowCountOutputDir=JobBuilderSupport.getJobWorkingDir(conf,jobId) + "/row_count";
  RedistributeFlatHiveTableStep step=new RedistributeFlatHiveTableStep();
  step.setInitStatement(hiveInitBuf.toString());
  step.setSelectRowCountStatement(JoinedFlatTable.generateSelectRowCountStatement(flatTableDesc,rowCountOutputDir));
  step.setRowCountOutputDir(rowCountOutputDir);
  step.setRedistributeDataStatement(JoinedFlatTable.generateRedistributeDataStatement(flatTableDesc));
  CubingExecutableUtil.setCubeName(cubeName,step.getParams());
  step.setName(ExecutableConstants.STEP_NAME_REDISTRIBUTE_FLAT_HIVE_TABLE);
  return step;
}
