{
  final String useDatabaseHql="USE " + engineConfig.getConfig().getHiveDatabaseForIntermediateTable() + ";";
  final String dropTableHql=JoinedFlatTable.generateDropTableStatement(intermediateTableDesc,jobId);
  final String createTableHql=JoinedFlatTable.generateCreateTableStatement(intermediateTableDesc,getJobWorkingDir(jobId),jobId);
  String insertDataHqls;
  try {
    insertDataHqls=JoinedFlatTable.generateInsertDataStatement(intermediateTableDesc,jobId,this.engineConfig);
  }
 catch (  IOException e1) {
    e1.printStackTrace();
    throw new RuntimeException("Failed to generate insert data SQL for intermediate table.");
  }
  ShellExecutable step=new ShellExecutable();
  StringBuffer buf=new StringBuffer();
  buf.append("hive ");
  buf.append(" -e \"");
  buf.append(useDatabaseHql + "\n");
  buf.append(dropTableHql + "\n");
  buf.append(createTableHql + "\n");
  buf.append(insertDataHqls + "\n");
  buf.append("\"");
  step.setCmd(buf.toString());
  step.setName(ExecutableConstants.STEP_NAME_CREATE_FLAT_HIVE_TABLE);
  return step;
}
