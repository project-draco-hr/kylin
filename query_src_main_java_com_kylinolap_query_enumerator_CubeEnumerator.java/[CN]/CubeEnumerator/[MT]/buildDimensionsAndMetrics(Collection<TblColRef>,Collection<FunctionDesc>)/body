{
  for (  FunctionDesc func : olapContext.aggregations) {
    if (!func.isAppliedOnDimension()) {
      metrics.add(func);
    }
  }
  if (olapContext.isSimpleQuery()) {
    for (    DimensionDesc dim : olapContext.cubeDesc.getDimensions()) {
      for (      TblColRef col : dim.getColumnRefs()) {
        dimensions.add(col);
      }
    }
    for (    MeasureDesc measure : olapContext.cubeDesc.getMeasures()) {
      FunctionDesc func=measure.getFunction();
      if (func.isSum()) {
        metrics.add(func);
      }
    }
    olapContext.storageContext.markAvoidAggregation();
  }
 else {
    for (    TblColRef column : olapContext.allColumns) {
      if (olapContext.metricsColumns.contains(column)) {
        continue;
      }
      dimensions.add(column);
    }
  }
}
