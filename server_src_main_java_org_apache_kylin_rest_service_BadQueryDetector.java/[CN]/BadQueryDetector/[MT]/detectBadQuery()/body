{
  long now=System.currentTimeMillis();
  ArrayList<Entry> entries=new ArrayList<Entry>(runningQueries.values());
  Collections.sort(entries);
  if (getSystemAvailMB() < alertMB) {
    logger.info("System free memory less than " + alertMB + " MB. "+ entries.size()+ " queries running.");
    for (int i=0; i < entries.size(); i++) {
      Entry e=entries.get(i);
      notify("Low mem",(int)((now - e.startTime) / 1000),e.sqlRequest.getSql());
    }
  }
  for (  Entry e : entries) {
    int runningSec=(int)((now - e.startTime) / 1000);
    if (runningSec >= alertRunningSec) {
      notify("Slow",runningSec,e.sqlRequest.getSql());
    }
 else {
      break;
    }
  }
}
