{
  try {
    long cachingSeconds=(kylinConfig.getBadQueryDefaultAlertingSeconds() + 1) * 10;
    Pair<Long,String> sqlPair=new Pair<>(startTime,sql);
    if (!cacheQueue.contains(sqlPair)) {
      badQueryManager.addEntryToProject(sql,adj,startTime,runningSec,serverHostname,t.getName(),project);
      cacheQueue.add(sqlPair);
      while (!cacheQueue.isEmpty() && (System.currentTimeMillis() - cacheQueue.first().getFirst() > cachingSeconds * 1000 || cacheQueue.size() > kylinConfig.getBadQueryHistoryNum() * 3)) {
        cacheQueue.pollFirst();
        logger.info("Poll first");
      }
    }
  }
 catch (  IOException e) {
    logger.error("Error in bad query persistence.",e);
  }
}
