{
  IGTScanner result=scanner;
  if (!doFilter) {
    int scanned=lookAndForget(result);
    return new EmptyGTScanner(scanned);
  }
 else {
    if (this.hasFilterPushDown()) {
      result=new GTFilterScanner(result,this);
    }
    if (!doAggr) {
      long scanned=result.getScannedRowCount();
      lookAndForget(result);
      return new EmptyGTScanner(scanned);
    }
    if (!this.allowPreAggregation) {
      logger.info("pre aggregation is not beneficial, skip it");
    }
 else     if (this.hasAggregation()) {
      logger.info("pre aggregating results before returning");
      result=new GTAggregateScanner(result,this);
    }
 else {
      logger.info("has no aggregation, skip it");
    }
    return result;
  }
}
