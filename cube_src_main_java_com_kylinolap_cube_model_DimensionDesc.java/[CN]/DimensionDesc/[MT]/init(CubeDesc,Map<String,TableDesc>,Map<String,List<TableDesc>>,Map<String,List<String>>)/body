{
  if (name != null)   name=name.toUpperCase();
  this.table=null;
  this.database=null;
  this.join=null;
  for (int i=0, n=this.column.length; i < n; i++) {
    String thisColumn=this.column[i].toUpperCase();
    String[] dbTableNames=parseTableDBName(thisColumn,columnTableMap,tableDatabaseMap);
    if (database == null) {
      database=dbTableNames[0];
    }
 else     if (!database.equals(dbTableNames[0])) {
      throw new IllegalStateException("One dimension can only refer to the tables in the same db: '" + database + "' and '"+ dbTableNames[0]+ "'.");
    }
    if (table == null) {
      table=dbTableNames[1];
    }
 else     if (!table.equalsIgnoreCase(dbTableNames[1])) {
      throw new IllegalStateException("One dimension can only refer to the columns on the same table: '" + table + "' and '"+ dbTableNames[1]+ "'.");
    }
  }
  tableDesc=tables.get(database + "." + table);
  if (tableDesc == null)   throw new IllegalStateException("Can't find table " + table + " on dimension "+ name);
  for (  LookupDesc lookup : cubeDesc.getModel().getLookups()) {
    if (lookup.getTable().equalsIgnoreCase(table)) {
      this.join=lookup.getJoin();
      break;
    }
  }
  if (isHierarchy && this.column.length > 0) {
    List<HierarchyDesc> hierarchyList=new ArrayList<HierarchyDesc>(3);
    for (int i=0, n=this.column.length; i < n; i++) {
      String aColumn=this.column[i];
      HierarchyDesc aHierarchy=new HierarchyDesc();
      aHierarchy.setLevel(String.valueOf(i + 1));
      aHierarchy.setColumn(aColumn);
      hierarchyList.add(aHierarchy);
    }
    this.hierarchy=hierarchyList.toArray(new HierarchyDesc[hierarchyList.size()]);
  }
  if (hierarchy != null && hierarchy.length == 0)   hierarchy=null;
  if (derived != null && derived.length == 0)   derived=null;
  if (hierarchy != null) {
    for (    HierarchyDesc h : hierarchy)     h.setColumn(h.getColumn().toUpperCase());
  }
  if (derived != null) {
    StringUtil.toUpperCaseArray(derived,derived);
  }
}
