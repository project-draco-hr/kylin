{
  job.setReducerClass(reducer);
  String htableName=seg.getStorageLocationIdentifier();
  Configuration conf=HBaseConfiguration.create(job.getConfiguration());
  HTable htable=new HTable(conf,htableName);
  int regions=htable.getStartKeys().length + 1;
  htable.close();
  int reducerNum=regions * 3;
  reducerNum=Math.max(1,reducerNum);
  KylinConfig kylinConfig=KylinConfig.getInstanceFromEnv();
  reducerNum=Math.min(kylinConfig.getHadoopJobMaxReducerNumber(),reducerNum);
  job.setNumReduceTasks(reducerNum);
  job.setOutputFormatClass(SequenceFileOutputFormat.class);
  job.setOutputKeyClass(Text.class);
  job.setOutputValueClass(Text.class);
  Path output=new Path(new HBaseMRSteps(seg).getCuboidRootPath(jobFlowId));
  FileOutputFormat.setOutputPath(job,output);
  HadoopUtil.deletePath(job.getConfiguration(),output);
}
