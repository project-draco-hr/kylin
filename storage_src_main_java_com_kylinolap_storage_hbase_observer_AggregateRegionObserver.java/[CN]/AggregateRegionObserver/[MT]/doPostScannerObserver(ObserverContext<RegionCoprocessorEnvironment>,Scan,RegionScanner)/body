{
  byte[] coprocessorEnableBytes=scan.getAttribute(COPROCESSOR_ENABLE);
  if (coprocessorEnableBytes == null || coprocessorEnableBytes.length == 0 || coprocessorEnableBytes[0] == 0) {
    return innerScanner;
  }
  byte[] typeBytes=scan.getAttribute(TYPE);
  ObserverRowType type=ObserverRowType.deserialize(typeBytes);
  byte[] projectorBytes=scan.getAttribute(PROJECTOR);
  ObserverProjector projector=ObserverProjector.deserialize(projectorBytes);
  byte[] aggregatorBytes=scan.getAttribute(AGGREGATORS);
  ObserverAggregators aggregators=ObserverAggregators.deserialize(aggregatorBytes);
  byte[] filterBytes=scan.getAttribute(FILTER);
  ObserverFilter filter=ObserverFilter.deserialize(filterBytes);
  HRegion region=ctxt.getEnvironment().getRegion();
  region.startRegionOperation();
  try {
synchronized (innerScanner) {
      return new AggregationScanner(type,filter,projector,aggregators,innerScanner);
    }
  }
  finally {
    region.closeRegionOperation();
  }
}
