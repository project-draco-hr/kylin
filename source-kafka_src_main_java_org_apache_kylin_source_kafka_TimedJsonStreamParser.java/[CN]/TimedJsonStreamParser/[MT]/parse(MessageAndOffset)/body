{
  try {
    Map<String,String> root=mapper.readValue(new ByteBufferBackedInputStream(messageAndOffset.message().payload()),mapType);
    String tsStr=root.get(tsColName);
    long t;
    if (StringUtils.isEmpty(tsStr)) {
      t=0;
    }
 else {
      t=Long.valueOf(tsStr);
    }
    ArrayList<String> result=Lists.newArrayList();
    long normalized=0;
    for (    TblColRef column : allColumns) {
      String columnName=column.getName();
      if (columnName.equalsIgnoreCase("minute_start")) {
        normalized=TimeUtil.getMinuteStart(t);
        result.add(DateFormat.formatToTimeStr(normalized));
      }
 else       if (columnName.equalsIgnoreCase("hour_start")) {
        normalized=TimeUtil.getHourStart(t);
        result.add(DateFormat.formatToTimeStr(normalized));
      }
 else       if (columnName.equalsIgnoreCase("day_start")) {
        normalized=TimeUtil.getDayStart(t);
        result.add(DateFormat.formatToDateStr(normalized));
      }
 else       if (columnName.equalsIgnoreCase("week_start")) {
        normalized=TimeUtil.getWeekStart(t);
        result.add(DateFormat.formatToDateStr(normalized));
      }
 else       if (columnName.equalsIgnoreCase("month_start")) {
        normalized=TimeUtil.getMonthStart(t);
        result.add(DateFormat.formatToDateStr(normalized));
      }
 else       if (columnName.equalsIgnoreCase("quarter_start")) {
        normalized=TimeUtil.getQuarterStart(t);
        result.add(DateFormat.formatToDateStr(normalized));
      }
 else       if (columnName.equalsIgnoreCase("year_start")) {
        normalized=TimeUtil.getYearStart(t);
        result.add(DateFormat.formatToDateStr(normalized));
      }
 else {
        String x=root.get(columnName.toLowerCase());
        result.add(x);
      }
    }
    return new StreamingMessage(result,messageAndOffset.offset(),t,Collections.<String,Object>emptyMap());
  }
 catch (  IOException e) {
    logger.error("error",e);
    throw new RuntimeException(e);
  }
}
