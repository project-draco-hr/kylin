{
  try {
    Map<String,String> root=mapper.readValue(new ByteBufferBackedInputStream(messageAndOffset.message().payload()),mapType);
    String tsStr=root.get(tsColName);
    long t;
    if (StringUtils.isEmpty(tsStr)) {
      t=0;
    }
 else {
      t=Long.valueOf(tsStr);
    }
    ArrayList<String> result=Lists.newArrayList();
    for (    TblColRef column : allColumns) {
      String columnName=column.getName();
      if (columnName.equalsIgnoreCase("minute_start")) {
        long minuteStart=TimeUtil.getMinuteStart(t);
        result.add(formatTs ? DateFormat.formatToTimeStr(minuteStart) : String.valueOf(minuteStart));
      }
 else       if (columnName.equalsIgnoreCase("hour_start")) {
        long hourStart=TimeUtil.getHourStart(t);
        result.add(formatTs ? DateFormat.formatToTimeStr(hourStart) : String.valueOf(hourStart));
      }
 else       if (columnName.equalsIgnoreCase("day_start")) {
        long ts=TimeUtil.getDayStart(t);
        result.add(DateFormat.formatToDateStr(ts));
      }
 else {
        String x=root.get(columnName.toLowerCase());
        result.add(x);
      }
    }
    return new StreamingMessage(result,messageAndOffset.offset(),t,Collections.<String,Object>emptyMap());
  }
 catch (  IOException e) {
    logger.error("error",e);
    throw new RuntimeException(e);
  }
}
