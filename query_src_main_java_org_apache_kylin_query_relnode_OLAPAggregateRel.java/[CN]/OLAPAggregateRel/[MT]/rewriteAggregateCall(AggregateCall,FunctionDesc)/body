{
  if (noPrecaculatedFieldsAvailable() && func.needRewriteField()) {
    logger.info(func + "skip rewriteAggregateCall because no pre-aggregated field available");
    return aggCall;
  }
  List<Integer> newArgList=Lists.newArrayList(aggCall.getArgList());
  if (func.needRewriteField()) {
    RelDataTypeField field=getInput().getRowType().getField(func.getRewriteFieldName(),true,false);
    if (newArgList.isEmpty()) {
      newArgList.add(field.getIndex());
    }
 else {
      newArgList.set(0,field.getIndex());
    }
  }
  String callName=aggCall.getAggregation().getName();
  RelDataType fieldType=aggCall.getType();
  SqlAggFunction newAgg=aggCall.getAggregation();
  if (func.isCount()) {
    newAgg=SqlStdOperatorTable.SUM0;
  }
 else   if (func.getMeasureType().getRewriteCalciteAggrFunctionClass() != null) {
    newAgg=createCustomAggFunction(callName,fieldType,func.getMeasureType().getRewriteCalciteAggrFunctionClass(callName));
  }
  AggregateCall newAggCall=new AggregateCall(newAgg,false,newArgList,fieldType,callName);
  return newAggCall;
}
