{
  output.setStatus(JobStepStatusEnum.RUNNING);
  Session session=null;
  Channel channel=null;
  int exitCode=-1;
  try {
    JSch jsch=new JSch();
    session=jsch.getSession(remoteUser,remoteHost,22);
    session.setPassword(remotePassword);
    session.setConfig("StrictHostKeyChecking","no");
    session.connect();
    channel=session.openChannel("exec");
    ((ChannelExec)channel).setCommand(command);
    channel.setInputStream(null);
    PipedInputStream in=new PipedInputStream(64 * 1024);
    PipedOutputStream out=new PipedOutputStream(in);
    channel.setOutputStream(out);
    ((ChannelExec)channel).setErrStream(out);
    channel.connect();
    byte[] tmp=new byte[1024];
    while (true) {
      while (in.available() > 0) {
        int i=in.read(tmp,0,1024);
        if (i < 0)         break;
        output.appendOutput(new String(tmp,0,i));
      }
      if (channel.isClosed()) {
        if (in.available() > 0) {
          continue;
        }
        exitCode=channel.getExitStatus();
        break;
      }
      try {
        Thread.sleep(1000);
      }
 catch (      Exception ee) {
        throw ee;
      }
    }
  }
 catch (  Exception e) {
    throw new JobException(e);
  }
 finally {
    if (channel != null) {
      channel.disconnect();
    }
    if (session != null) {
      session.disconnect();
    }
  }
  return exitCode;
}
