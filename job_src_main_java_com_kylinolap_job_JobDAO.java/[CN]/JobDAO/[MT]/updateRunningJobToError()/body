{
  List<JobInstance> runningJobs=listAllJobs(JobStatusEnum.RUNNING);
  for (  JobInstance job : runningJobs) {
    int lastRunningStepIndex=0;
    for (int i=job.getSteps().size() - 1; i >= 0; i--) {
      JobStep currentStep=job.getSteps().get(i);
      if (currentStep.getStatus() != JobStepStatusEnum.RUNNING && currentStep.getStatus() != JobStepStatusEnum.WAITING) {
        continue;
      }
 else {
        lastRunningStepIndex=i;
        break;
      }
    }
    job.getSteps().get(lastRunningStepIndex).setStatus(JobStepStatusEnum.ERROR);
    this.updateJobInstance(job);
    this.saveJobOutput(job.getUuid(),lastRunningStepIndex,"ERROR state set by job engine");
  }
}
