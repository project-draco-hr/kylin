{
  keyText.set(key.get());
  aggs.reset();
  for (  Text value : values) {
    codec.decode(value,input);
    aggs.aggregate(input);
  }
  aggs.collectStates(result);
  KeyValue outputValue;
  int n=keyValueCreators.size();
  if (n == 1 && keyValueCreators.get(0).isFullCopy) {
    valueBuf.clear();
    codec.encode(result,valueBuf);
    outputValue=keyValueCreators.get(0).create(keyText,valueBuf.array(),0,valueBuf.position());
    context.write(key,outputValue);
  }
 else {
    for (int i=0; i < n; i++) {
      outputValue=keyValueCreators.get(i).create(keyText,result);
      context.write(key,outputValue);
    }
  }
  counter++;
  if (counter % BatchConstants.COUNTER_MAX == 0) {
    logger.info("Handled " + counter + " records!");
  }
}
